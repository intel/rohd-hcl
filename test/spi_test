// Copyright (C) 2024 Intel Corporation
// SPDX-License-Identifier: BSD-3-Clause
//
// spi_test.dart
// Tests for SPI interface
//
// 2024 September 23
// Author: Roberto Torres <roberto.torres@intel.com>

import 'package:rohd/rohd.dart';
import 'package:rohd_hcl/rohd_hcl.dart';
import 'package:test/test.dart';

class SpiMain extends Module {
  final SpiInterface spiInterface;

  SpiMain() : spiInterface = SpiInterface() {
    // Add the SPI interface to the module
    addOutput(spiInterface.clk);
    addOutput(spiInterface.mosi);
    addInput(spiInterface.miso);
    addOutput(spiInterface.cs);
  }
}

class SpiSub extends Module {
  final SpiInterface spiInterface;

  SpiSub() : spiInterface = SpiInterface() {
    // Add the SPI interface to the module
    addInput(spiInterface.clk);
    addInput(spiInterface.mosi);
    addOutput(spiInterface.miso);
    addInput(spiInterface.cs);
  }
}

void main() {
  // Instantiate the master and slave modules
  final main = SpiMain();
  final sub = SpiSub();

  // Connect the SPI interfaces
  main.spiInterface.pairConnectIO(
    main,
    sub.spiInterface,
    PairRole.provider,
  );

  // Optionally, you can also connect the slave to the master
  sub.spiInterface.pairConnectIO(
    slave,
    master.spiInterface,
    PairRole.consumer,
  );

  // Build the design
  final design = Design([master, slave]);
  design.build();
}